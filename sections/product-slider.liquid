{% comment %}
  Product Slider Component for Shopify Dawn Theme
  Displays a slider with product cards including wishlist, size selector, and add to cart
{% endcomment %}

{{ 'product-slider.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="product-slider-section section-{{ section.id }}-padding">
  <div class="product-slider-content ">
    {% if section.settings.title != blank %}
      <h2 class="product-slider-title">{{ section.settings.title }}</h2>
    {% endif %}

    <div class="product-slider-container">
      {% render 'slider-arrows',
        direction: 'prev',
        class: 'product-slider-arrow product-slider-arrow--prev',
        label: 'Banner anterior'
      %}

      <div class="product-slider-wrapper">
        <div class="product-slider-track">
          {% for product in section.settings.collection.products limit: section.settings.products_to_show %}
            <div class="product-card" data-product-id="{{ product.id }}">
              <div class="product-card__media">
                {% if product.featured_image %}
                  <img
                    src="{{ product.featured_image | image_url: width: 500 }}"
                    srcset="{{ product.featured_image | image_url: width: 165 }} 165w,
                            {{ product.featured_image | image_url: width: 360 }} 360w,
                            {{ product.featured_image | image_url: width: 533 }} 533w,
                            {{ product.featured_image | image_url: width: 720 }} 720w,
                            {{ product.featured_image | image_url: width: 940 }} 940w"
                    sizes="(min-width: 1200px) 267px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                    alt="{{ product.featured_image.alt | escape }}"
                    loading="lazy"
                    class="product-card__image"
                  >
                {% else %}
                  {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                {% endif %}

                {% if product.compare_at_price > product.price %}
                  {% assign discount_percentage = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round %}
                  <span class="product-card__badge">{{ discount_percentage }}% OFF</span>
                {% endif %}

                <button class="product-card__wishlist" aria-label="Add to wishlist">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>

                <div class="product-card__overlay">
                  <div class="product-card__size-selector">
                    <p class="size-selector__label">Selecione um tamanho</p>
                    <div class="size-selector__options">
                      <button class="size-selector__arrow size-selector__arrow--prev" aria-label="Previous size">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </button>
                      
                      <div class="size-selector__track-wrapper">
                        <div class="size-selector__track">
                          {% if product.variants.size > 0 %}
                            {% for variant in product.variants %}
                              {% if variant.option1 %}
                                <button 
                                  class="size-selector__option {% if forloop.first %}active{% endif %}" 
                                  data-variant-id="{{ variant.id }}"
                                  {% unless variant.available %}disabled{% endunless %}
                                >
                                  {{ variant.option1 }}
                                </button>
                              {% endif %}
                            {% endfor %}
                          {% else %}
                            <button class="size-selector__option active">Único</button>
                          {% endif %}
                        </div>
                      </div>

                      <button class="size-selector__arrow size-selector__arrow--next" aria-label="Next size">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </button>
                    </div>
                  </div>

                  <button class="product-card__add-to-cart" data-product-id="{{ product.id }}">
                    Adicionar à sacola
                  </button>
                </div>
              </div>

              <div class="product-card__info">
                <h3 class="product-card__title">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h3>

                <div class="product-card__price">
                  <span class="price price--current">
                    {{ product.price | money }}
                  </span>
                  {% if product.compare_at_price > product.price %}
                    <span class="price price--compare">
                      {{ product.compare_at_price | money }}
                    </span>
                  {% endif %}
                </div>

                {% if section.settings.show_installments %}
                  {% assign installment_value = product.price | divided_by: 6.0 %}
                  <p class="product-card__installments">
                    ou 6x de {{ installment_value | money }} sem juros
                  </p>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      {% render 'slider-arrows',
        direction: 'next',
        class: 'product-slider-arrow product-slider-arrow--next',
        label: 'Próximo banner'
      %}
    </div>

    <div class="product-slider-dots"></div>
  </div>
</div>

<script src="{{ 'product-slider.js' | asset_url }}" defer></script>


{% schema %}
{
  "name": "Product Slider",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Título",
      "default": "Favoritos da Semana"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Coleção"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 20,
      "step": 1,
      "label": "Produtos para mostrar",
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_installments",
      "label": "Mostrar parcelas",
      "default": true
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding superior",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding inferior",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Product Slider"
    }
  ]
}
{% endschema %}
